---
import { Clock } from 'lucide-react';

const { post, categoryName } = Astro.props;
const formattedDate = new Date(post.date).toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
const featureImage = post.featuredImage?.node?.sourceUrl || '/logo.png';
const authorName = post.author?.node?.name || 'Editor';
const authorAvatar = post.author?.node?.avatar?.url;
---

<article class="bg-white rounded-2xl p-4 hover:shadow-xl transition-shadow duration-300 border border-gray-100 flex flex-col sm:flex-row gap-6 items-stretch h-full">
  <!-- Image Section (40%) -->
  <a href={`/post/${post.slug}`} class="w-full sm:w-2/5 shrink-0 block relative group overflow-hidden rounded-xl aspect-video sm:aspect-auto sm:h-auto bg-gray-100">
    {post.featuredImage?.node?.sourceUrl ? (
        <img 
        src={post.featuredImage?.node?.sourceUrl} 
        alt={post.title} 
        class="absolute inset-0 w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500"
        />
    ) : (
        <div class="absolute inset-0 w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200 group-hover:scale-105 transition-transform duration-500">
             <img src="/logo.png" alt="The Times Clock" class="w-16 h-16 object-contain opacity-50 grayscale" />
        </div>
    )}
  </a>

  <!-- Content Section (60%) -->
  <div class="flex-1 flex flex-col py-1">
    
    <!-- Header: Label -->
    <div class="mb-3">
        <span class="inline-block px-2 py-0.5 rounded text-[10px] sm:text-[11px] font-bold bg-[#a855f7]/10 text-[#a855f7] uppercase tracking-wider border border-[#a855f7]/20">
            {categoryName || 'Case Study'}
        </span>
    </div>

    <!-- Title -->
    <a href={`/post/${post.slug}`} class="group">
        <h3 class="text-xl font-bold text-gray-900 leading-tight mb-3 group-hover:text-blue-600 transition-colors">
            {post.title}
        </h3>
    </a>

    <!-- Analyst Breakdown (Checklist) -->
    <div class="mb-6">
        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">Analyst Breakdown</p>
        <ul class="space-y-1.5">
            {(() => {
                // Extract points from content
                let points = [];
                if (post.content) {
                    // Try to find list items first
                    const listMatches = post.content.match(/<li>(.*?)<\/li>/g);
                    if (listMatches) {
                         points = listMatches.slice(0, 3).map(item => item.replace(/<\/?li>/g, '').replace(/<[^>]*>/g, '').trim());
                    } 
                    
                    // If no list items, split by sentences
                    if (points.length === 0) {
                        const sentences = post.content.replace(/<[^>]*>/g, '').split(/[.!?]/).filter(s => s.trim().length > 10);
                        points = sentences.slice(0, 3).map(s => s.trim());
                    }
                }

                // Fallback defaults if extraction fails
                if (points.length === 0) {
                     points = [
                        "Revenue model & margins",
                        "Customer acquisition strategy",
                        "Tech stack & scaling tools"
                    ];
                }

                // Ensure always 3 items for layout consistency
                while (points.length < 3) {
                    points.push("Business strategy & insights");
                }
                
                return points.slice(0, 3).map(point => (
                    <li class="flex items-center gap-2 text-xs font-medium text-gray-600">
                        <svg class="w-3.5 h-3.5 text-green-500 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path d="M5 13l4 4L19 7"/></svg>
                        <span class="line-clamp-1">{point}</span>
                    </li>
                ));
            })()}
        </ul>
    </div>

    <!-- Footer: Author & Date -->
    <div class="mt-auto flex items-center gap-3 pt-4 border-t border-gray-100">
        {authorAvatar && <img src={authorAvatar} alt={authorName} class="w-6 h-6 rounded-full" />}
        <span class="text-xs font-bold text-gray-900">{authorName}</span>
        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider ml-auto">{formattedDate}</span>
    </div>
  </div>
</article>
